<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="$views/css/image.css">
        <link rel="stylesheet" href="$views/css/list.css">
        <link rel="stylesheet" href="$views/css/buttons.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/github.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
    </head>
    <body>
        <div id="wrapper">
            <div class="nav previous">
                <button id="previous" class="fa fa-backward"></button>
            </div>

            <div class="content">
                <h2 class="artist"><a class="metadata" href="#" id="artist"></a></h2>
                <h3 class="album"><a class="metadata" href="#" id="album"></a></h3>
                <div class="starred">
                    <button id="star" class="fa fa-star"></button>
                </div>
                <div id="album-image"></div>
                <h2 class="track"><a class="metadata" href="#" id="track">Album Title</a></h2>
            </div>

            <div class="nav next">
                <button id="next" class="fa fa-forward"></button>
            </div>
        </div>

    <script type="text/javascript">
        require(['$api/models', '$views/image#Image', '$api/library#Library'], function(models, Image, Library) {

            var currentLibrary = Library.forCurrentUser(),
                player = models.player,
                track = '',
                album = '',
                trackContainer = document.getElementById('track'),
                artistContainer = document.getElementById('artist'),
                albumContainer = document.getElementById('album'),
                button = document.getElementById('star'),
                previous = document.getElementById('previous'),
                next = document.getElementById('next');

            var updateStar = function() {
                track.load('starred').done(function(t) {
                    if (t.starred) {
                        currentLibrary.unstar(track).done(function() {
                            updateStarButton();
                        });
                    } else {
                        currentLibrary.star(track).done(function() {
                            updateStarButton();
                        });
                    }
                });
            }

            function updateStarButton() {
                if (track.starred) {
                    button.className = "fa fa-star";
                } else {
                    button.className = "fa fa-star-o";
                }
            }

            function updateTrackInfo() {
                if (track === null) {
                    trackContainer.innerHTML = 'Nothing currently playing';
                } else {
                    imageContainer = document.getElementById('album-image');

                    artistContainer.innerHTML = track.artists[0].name;
                    trackContainer.innerHTML =  track.name;
                    track.album.load('name').done(function(a) {
                        albumContainer.innerHTML =  a.name;
                    });

                    updateStarButton();

                    image = Image.forTrack(track, { width: 600, height: 600 });
                    imageContainer.innerHTML = '';
                    imageContainer.appendChild(image.node);
                }
            }

            function skipPrevious(){
                player.skipToPrevTrack();
            }

            function skipNext(){
                player.skipToNextTrack();
            }

            button.addEventListener('click', updateStar);
            button.addEventListener('hover', updateStar);

            previous.addEventListener('click', skipPrevious);
            next.addEventListener('click', skipNext);

            player.load('track').done(function(p) {
                track = models.Track.fromURI(p.track.uri);
                updateTrackInfo();
            });

            player.addEventListener('change', function(p) {
                button.removeEventListener('click', updateStar);
                track = models.Track.fromURI(p.data.track.uri);

                button.addEventListener('click', updateStar);
                updateTrackInfo();
            });
        });
    </script>
    <script src="/js/rainbow-custom.min.js"></script>
    <script src="/js/tutorial.js"></script>
    </body>
</html>
